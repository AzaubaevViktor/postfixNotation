#include "bigNum.h"
#include <string.h>
#define ERROR if (*error) return NULL
#define CLEAN ;

#define getDigit(num,digit) (((num)->len > (digit)) ? (num)->digits[(digit)] : 0)

#define checkNum(num) (((num) >= 0) && ((num) <= 9))

static size_t getMaxLen(BigNum *a, BigNum *b) {
  return (a->len > b->len) ? (a->len) : (b->len);
}

static size_t getMinLen(BigNum *a, BigNum *b) {
  return (a->len < b->len) ? (a->len) : (b->len);
}

static void setBigNumLen(BigNum *num, size_t newLen, int *error) {
  size_t len = 0;
  *error = 0;

  num->digits = realloc(num->digits,sizeof(char)*newLen);
  if (!(num->digits)) {
    *error = MEMORY_ALLOCATE_ERROR;
    return;
  }

  for (len = num->len; len < newLen;) {
    num->digits[len] = '\0';
    len++;
  }

  num->len = newLen;
}

#define modchar(a,b) (((a) % (b) < 0) ? (a) % (b) + b : (a) % (b))

#define divchar(a,b) (((((a) / (b))*(b)) > (a)) ? ((a) / (b) - 1) : ((a) / (b)))

static void deleteZeros(BigNum *num) {
  size_t len = 0;
  int error = 0;

  for (len = num->len; (len>1) && (0 == num->digits[len-1]); len--);

  if ((0 == num->digits[0]) && (1 >= len)) num->sig = 1;

  setBigNumLen(num,len,&error);
}

static void moveBigNum(BigNum *to, BigNum *from) {
  to->len = from->len;
  to->sig = from->sig;
  free(to->digits);
  to->digits = from->digits;
  from->digits = NULL;
  deleteBigNum(from);
}

static BigNum *copyBigNum(BigNum *from, int *error) {
  BigNum *to = NULL;
  *error = 0;

  to = newBigNum(error);
  ERROR;

  setBigNumLen(to,from->len,error);
  ERROR;

  to->sig = from->sig;

  memcpy(to->digits,from->digits,from->len);

  return to;
}

static BigNum *tenInDeg(size_t deg, int *error) {
  BigNum *num = NULL;
  *error = 0;

  num = newBigNum(error);
  ERROR;

  setBigNumLen(num,deg+1,error);
  ERROR;

  num->digits[deg] = 1;

  return num;
}

BigNum *newBigNum(int *error) {
  BigNum *num = calloc(1,sizeof(BigNum));
  *error = 0;

  if (!num) {
    *error = MEMORY_ALLOCATE_ERROR;
    return NULL;
  }

  num->digits = calloc(1,sizeof(char));
  if (!num->digits) {
    *error = MEMORY_ALLOCATE_ERROR;
    free(num);
    num = NULL;
  }

  num->len = 1;
  num->sig = 1;

  return num;
}

void deleteBigNum(BigNum *num) {
  if (num) {
    free(num->digits);
    free(num);
  }
}

void null(BigNum *num, int *error) {
  size_t i = 0;
  *error = 0;
  if (!num) {
    *error = NOT_BIG_NUM;
    return;
  }

  num->sig = 1;

  for (i = 0; i < num->len; i++) {
    num->digits[i] = 0;
  }

  deleteZeros(num);
}

int compare(BigNum *a, BigNum *b) {
  if (a->sig > b->sig) return -1;
  if (a->sig < b->sig) return 1;
  return compare_abs(a,b);
}

int compare_abs(BigNum *a, BigNum *b) {
  size_t maxlen = 0;
  size_t i = 0;
  if (!(a && b)) return -2;
  maxlen = getMaxLen(a,b);
  for (i = 0; maxlen > i; i++) {
    if (getDigit(a,maxlen-i-1) > getDigit(b,maxlen-i-1)) return -1;
    if (getDigit(a,maxlen-i-1) < getDigit(b,maxlen-i-1)) return 1;
  }
  return 0;
}

BigNum *intToBigNum(int64_t in, int *error) {
  size_t len = 0, i = 0, sig = 1;
  BigNum *num = NULL;
  *error = 0;

  num = newBigNum(error);
  ERROR;

  if (in < 0) {
    sig = -1;
    in = -in;
  }

  num->sig = sig;

  for (i = 1; in >= i; (i *= 10, len++));

  setBigNumLen(num,len ? len : 1,error);
  ERROR;

  for ((i /= 10, len--); 0 < i; (i /= 10, len--)) {
    num->digits[len] = in / i;
    in %= i;
  }

  return num;
}

BigNum *stringToBigNum(char *s, int *error) {
  char *_s = s; /* hack for '-' */
  char *ch = NULL;
  size_t len = 0, i = 0;
  BigNum *num = NULL;
  *error = 0;

  for (ch = s; *ch; (len++, ch++));

  num = newBigNum(error);
  ERROR;

  num->sig = ((len>0) && ('-' == *_s)) ? (_s++,len--,-1) : 1;

  for (; '0' == *_s; (_s++,len--));

  setBigNumLen(num,(0 == len) ? 1 : len,error);
  ERROR;

  for (i = 0; i < len; i++) {
    if (!checkNum(_s[i] - '0')) {
      *error = PARSE_STRING_ERROR;
      deleteBigNum(num);
      return NULL;
    }
    num->digits[i] = _s[len - i - 1] - '0';
  }

  if ((0 == num->digits[0]) && (1 >= num->len)) num->sig = 1;

  return num;
}

char *BigNumToString(BigNum *num, int *error) {
  char *s = NULL, *_s = NULL;
  size_t i = 0;
  *error = 0;

  if (!num) {
    *error = NOT_BIG_NUM;
    return NULL;
  }

  _s = s = calloc((num->len) + (-1 == num->sig) + 1, sizeof(char));
  if (!s) {
    *error = MEMORY_ALLOCATE_ERROR;
    return NULL;
  }

//  deleteZeros(num);

  if (-1 == num->sig) {
    *s = '-';
    s++;
  }

  for (i = 0; i < num->len; i++) {
    s[num->len-1-i] = (char) num->digits[i] + '0';
  }

  s[i] = '\0';

  return _s;
}


BigNum *add(BigNum *a, BigNum *b, int isReturn, int *error) {
  BigNum *result = NULL;
  signed char siga = 0, sigb = 0;
  BigNum *maxNum = NULL, *minNum = NULL;
  size_t maxLen = 0;
  size_t i = 0;
  signed char res = 0, carry = 0;
  *error = 0;

  if (!(a && b)) {
    *error = NOT_BIG_NUM;
    return NULL;
  }
  result = newBigNum(error);
  ERROR;

  siga = a->sig;
  sigb = b->sig;

  a->sig = 1;
  b->sig = 1;

  maxNum = (1 == compare(a,b)) ? b : a;
  minNum = (maxNum == a) ? b : a;

  a->sig = siga;
  b->sig = sigb;

  if (-1 == maxNum->sig) {
    maxNum->sig = 1;
    minNum->sig = -(minNum->sig);
    result->sig = -1;
  }

  maxLen = getMaxLen(minNum,maxNum);

  setBigNumLen(result,maxLen,error);
  ERROR;
  for (i = 0; i < maxLen; i++) {
    res = getDigit(a,i)*(a->sig) + getDigit(b,i)*(b->sig) + carry;
    carry = divchar(res,10);
    result->digits[i] = modchar(res,10);
  }

  a->sig = siga;
  b->sig = sigb;


  if (carry) {
    setBigNumLen(result,maxLen+1,error);
    result->digits[maxLen] = carry;
  }

  deleteZeros(result);

  return (isReturn) ? result : (moveBigNum(a,result),NULL);
}

BigNum *dif(BigNum *a, BigNum *b, int isReturn, int *error) {
  signed char sigb = 0;
  BigNum *result = NULL;
  if (!b) {
    *error = NOT_BIG_NUM;
    return NULL;
  }

  sigb = b->sig;
  b->sig = -b->sig;
  result = add(a,b,isReturn,error);
  b->sig = sigb;
  return result;
}

BigNum *mul(BigNum *a, BigNum *b, int isReturn, int *error) {
  BigNum *result = NULL;
  size_t ai = 0, bi = 0, ri = 0, len = 0;
  signed char res = 0, carry = 0;
  *error = 0;

  if ((!a) && (!b))
  {
    *error = NOT_BIG_NUM;
    return NULL;
  }

  result = newBigNum(error);
  if ((*error) || (!result)) return NULL;

  len = a->len + b->len + 10;
  setBigNumLen(result,len,error);
  result->sig = (a->sig) * (b->sig);
  ERROR;

  for (ai = 0; ai < a->len; ai++) {
    for (bi = 0; bi < b->len; bi++) {
      ri = ai+bi;
      res = (a->digits[ai]) * (b->digits[bi]) + result->digits[ri];
      carry = divchar(res,10);
      result->digits[ri] = modchar(res,10);
      for (ri++; 0 != carry; ri++) {
        res = result->digits[ri] + carry;
        carry = divchar(res,10);
        result->digits[ri] = modchar(res,10);
      }
    }
  }

  deleteZeros(result);

  if (!isReturn) {
    moveBigNum(a,result);
  } else {
  return result;
  }

  return NULL;
}

BigNum *divd_mod(BigNum *_a, BigNum *_b, int isReturn, int divdReturn, int *error) {
  /* a = res * b + mod
   * В необработке ошибок таятся утечки памяти -- нужно  перед выходом чистить все переменные! */
  //TODO: правильная, нетекучая обработка ошибок
  BigNum *res = NULL, *ten = NULL, *a = NULL, *null = NULL;
  size_t alen = 0, blen = 0, len = 0, asig = 0, bsig = 0;
  *error = 0;

  if ((!_a) && (!_b)) {
    *error = NOT_BIG_NUM;
    return NULL;
  }

  if (BMOREA == compare_abs(_a,_b)) {
    res = newBigNum(error);
    ERROR;
    res->sig = _a->sig * _b->sig;
    return res;
  }

  asig = _a->sig;
  bsig = _b->sig;

  res = newBigNum(error);
  ERROR;
  ten = newBigNum(error);
  ERROR;
  null = newBigNum(error);
  ERROR;

  if (AEQB == compare_abs(_b,null)) {
    *error = DIVISION_BY_ZERO;
    return NULL;
  }

  a = copyBigNum(_a,error);
  ERROR;
  blen = _b->len;
  alen = a->len;
  len = alen-blen;
  if (divdReturn) setBigNumLen(res, len + 1, error);
  ERROR;

  if (asig != bsig) unDif(_b,0,error);

  for (; BMOREA != compare_abs(a,_b); len--) {
    moveBigNum(ten,tenInDeg(len,error));
    ERROR;
    mul(ten,_b,0,error);
    ERROR;
    while (BMOREA != compare_abs(a,ten)) {
      dif(a,ten,0,error);
      if (divdReturn) res->digits[len] += 1;
    }
  }

  _a->sig = asig;
  _b->sig = bsig;

  if (!divdReturn) {
    res = copyBigNum(a,error);
    ERROR;
  }

  if (asig != bsig) {
    if (divdReturn) {
      moveBigNum(ten,stringToBigNum("1",error));
      add(res,ten,0,error);
      ERROR;
      res->sig = -1;
    } else {
      add(res,_b,0,error);
      ERROR;
    }
  }

  deleteBigNum(ten);
  deleteBigNum(a);

  deleteZeros(res);

  return (isReturn) ? res : (moveBigNum(_a,res),NULL);
}

BigNum *divd(BigNum *_a, BigNum *_b, int isReturn, int *error) {
  return divd_mod(_a,_b,isReturn,1,error);
}

BigNum *mod(BigNum *_a, BigNum *_b, int isReturn, int *error) {
  return divd_mod(_a,_b,isReturn,0,error);
}

BigNum *deg(BigNum *a, BigNum *b, int isReturn, int *error) {
  BigNum *res = NULL, *degree = NULL, *two = NULL, *one = NULL, *nul = NULL;
  *error = 0;

  res = stringToBigNum("1",error);  ERROR;
  degree = stringToBigNum("2",error);  ERROR;
  two = stringToBigNum("2",error);  ERROR;
  one = stringToBigNum("1",error);  ERROR;
  nul = newBigNum(error);  ERROR;


  switch(compare(b,nul)) {
  case AEQB:
    return (isReturn) ? res : (moveBigNum(a,res),NULL);
    break;
  case BMOREA:
    null(res,error); ERROR;
    return (isReturn) ? res : (moveBigNum(a,res),NULL);
    break;
  }

  deleteBigNum(res);
  res = copyBigNum(a,error);

  while (BMOREA == compare_abs(degree,b)) {
    mul(res,res,0,error);  ERROR;
    mul(degree,two,0,error);  ERROR;
  }

  divd(degree,two,0,error);  ERROR;
  
  while (BMOREA == compare_abs(degree,b)) {
    mul(res,a,0,error); ERROR;
    add(degree,one,0,error);
  }

  return (isReturn) ? res : (moveBigNum(a,res),NULL);
}

BigNum *unDif(BigNum *a, int isReturn, int *error) {
  BigNum *result = 0;
  switch (isReturn) {
  case 0:
    a->sig = - a->sig;
    deleteZeros(a);
    return 0;
    break;
  case 1:
    result = copyBigNum(a,error);
    result->sig = - a->sig;
    deleteZeros(result);
    return result;
  }
  return 0;
}


/* ========================= TESTS ======================== */

#ifdef BIGNUM_TESTS

void BigNum_tests() {
  char resultHtml[2][100] = {"<font style='color:red'>FAIL</font>","<font style='color:green'>OK</font>"};
  char *sin,*sout = 0;
  char testsModChar[][4] = { {125,24,5,5}, {10,3,1,3}, {-10,3,2,-4}, {-100,66,32,-2}, {-100,-13,-9,7}, {-127,-127,-127,-127} };
  int64_t testInt[] = {0,-123,712637,124124438895,-321499875,-0,-1,777};
  char testIntAns[][30] = {"0","-123","712637","124124438895","-321499875","0","-1"};
  char testInterconversion[][2][1000] = {
    {"84371321499123965911030412040148392","84371321499123965911030412040148392"},
    {"000000084371321499123965911030412040148392","84371321499123965911030412040148392"},
    {"-21473789349342723434884785893284326190","-21473789349342723434884785893284326190"},
    {"","0"},
    {"-0","0"},
    {"-0000000000","0"},
    {"000000000000000000000000000000000000000000000000000","0"},
    {"00000000000000000000000000000000000000000000010","10"},
    {"-00000000000000000000000000010","-10"},
    {"22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222","22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222"},
    {"\5",""},
    {"",""}
  };
  char testUnDif[][2][1000] = {
    {"10","-10"},
    {"-10","10"},
    {"0","0"},
    {"\5",""},
    {"",""}
  };
  char testAdd[][3][1000] = {
    {"1","1","2"},
    {"11","24","35"},
    {"15","336","351"},
    {"111","999","1110"},
    {"-10","10","0"},
    {"-10","-11","-21"},
    {"-10","11","1"},
    {"-1001","-9000","-10001"},
    {"12","-121","-109"},
    {"-892347825478249825798","982347642677428924764265248","982346750329603446514439450"},
    {"123456789012345678901234567890","-987654321987654321","123456789011358024579246913569"},
    {"10000000000000000000000000000000000000","-1","9999999999999999999999999999999999999"},
    {"892347825478249825798","-982347642677428924764265248","-982346750329603446514439450"},
    {"87655678976528439214046327140743924104348219436078512234324024380256187052383812680124240326813806423871563781563781518302682473812461063980173127057970384791324732915713982572398147981324739812561398256348479382174398125739215739284793124739824731982573981259846398124739812471924781237406589123653980125473298","-6574893017391068379454678156749814389181148156481357747247279417943179347818713487918471479800788631258851287950095660569023980734287431287034187901209869586051798015279804312780134798126751267565445347686889047980532414576785675246575897632356356849634635467865432256789763543245678909576534512437128493868472312345637487658392564525115675976923452136567367827154725368396757426546824987984256394903584827654823481726583493848236775983918484263984328496982349813856482764709474659814984932856874783256785679932","-6574893017391068379454678156749814389181148156481357747247279417943179347818713487918471479800788631258851287950095660569023980734287431287034187901209869586051798015279804312780134798126751267565445260031210071452093200530458534502651793284136920771122401143841052000602711159432998785336207698630704622304690748564119184975918752064051695803796394166182576502421809654414185028398843663244443833505328479175441307328457754632497491190793744439252345923001089967458358024897002735033747526267751129276660206634"},
    {"1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111","-111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111","1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"},
    {"111111","-111","111000"},
    {"\5","",""},
    {"","",""}
  };
  char testDif[][3][1000] = {
    {"14","8","6"},
    {"14","99","-85"},
    {"14","-23","37"},
    {"-65","29","-94"},
    {"-84","-198","114"},
    {"873412724724787787347347134261337843173734173412732531892461947983146781469315469156315415473164793468312647354631578132678312489312684131967831543127573298714637124","328473124678312467381471894938124693254631249812548371257381248146184732549731579156379812469812647931247893125478314","873412724724787787347347134261337843173734173412404058767783635515765309574377344463060784223352245097055266106485393400128580910156304319498018895196325405589158810"},
    {"\5","",""},
    {"","",""}
  };
  char testMul[][3][20001] = {
    {"12","23","276"},
    {"-918","6645","-6100110"},
    {"-10","-10","100"},
    {"101","-999","-100899"},
    {"100000001","-9999999999999","-1000000009999899999999"},
    {"999","99999","99899001"},
    {"4378734347437914378849734817","8938434131438478794389712","39139028543641048444983533215293854345188258553002704"},
    {"9871324985193285123095093125983258105735710257312783141293440537398012732904732501928578","8777098312743219640392643274081825789127493824791284731289579826519237498124739247392810743127590","86641589872079970453346922152866570809167908982093334164784680757207402130923573893981126471379977792088696522841830516146343080946253477567327665446314216947221834390894477034521267020"},
//    {"9459127203087177707112670277626369117824314597435475571318386967259622034994993337780409393398011194209424763087062032260578169901096394430085348343979860139657042780825806324838301184938121657059672157903434141375195863863982118642704519767206835707002675824523562830943326784770329719814874632033404076852423845529037243108641673749460877681544822120810843153515375929874397082136721598952560964753023599628237597944544550396582601256853983853429727060796296928035501097560312046713658790886760112265235156110460296224833949095139584053890854435392487494781515202717815279136597056873546805219737169961936249605086887119604675526316295761772573719357404324933878300690782126218144273185643381677743522066413480081861669855565924986791275445928971848909305987096156889146007203941970016370141721453963765050338719529685257184348542647700782840598741605417884573498729896270925115717522412944357812170882355647208620586349100477850272661227940918092837687456744847301060249285967828697708669391556515918559869008842735641515219151730476434692941493713805011528578501388704107373504163481351358988701667761197664654919685086195281047232609389553217422529183093187694686035982683444887642002077876809090932094234213335252779208639139107166763896137273063636774136423982702796183613911419046244540276732612514552840793585212773384097327885254449531608947118365350471889823041714590865355843231366680598401789455858314317674434509587411748665440762601120331108374212553461179087135304790994447948579625068989781396807276318366277789993827548182934615335328986714435963050925713798347322945592990894874427783119861392402373272146696760650831895042247087604136606281666395726359905251973036368037753372015578015684402349427158462523922502016770652375804838666320331075774094961800946514341818048262198636558990477618136416312759413447466582833276538795153864277348686639843746620438099715709833181204988840874257294075753404491363555105851744164313163598655949583167364535631383082648234744671478582215581580993663460755579777837280695618257736595983646844126696843120506604317049179762281610898317196622643633673813760731638082787663913499148077958882537977114525700693053480614471954809412857662266783480173305772120441251033855097892283768165347497192134976998164681519507611583175378036838557744923078874552801006590551185724804022156718861571590817092628333809668171832757607994676508500663192854146788253537716899369997536154896852890263361814095338041137566402702748963076926471051209196646077647406543181723962213150025905673913172142656021850366809996077638094155573731806567581910378273093606271709904563072115227117889934470864984287190568767386410054587347199183131433349771052985684019042931573074928397938935495983454015406896427066211386883300873650444887985767307179259393004707453902380076231456863483321206766705512651201848974582550378541484622216552305237560848203692446924609185368780944704135709623217512661135619505546771005785168421241639146374039997332671096085141426736096838082765187141094020645480776071569757407200987692972305431960173072449139904165598508126664807186417741588369208906892246525066612164386330469457850232554118277481361121681854286092421070455416199037971350645161442623230173440659980601470097433452837480817491484697309779548229276126077661825166790794796094345198960377025262250903826852492034217917563903838011037766049357391056609513925050450431554429265985353943861250743266857486278765363414083776034034230534846886148400292074933168535187672410612151382039057172979034002803892658696434980048579155069234054773741002091524205964682837595021763942819794871577396368888276113254091099998198513201573420497175526439460807258980225771920148820611374900128736190013630909421091644170912744724403205108494636028353268691717113562553563129517759979043720163268968048078901927571014151395181906142187374112177728124943122423048830173862598011638843766348870418557734533876504073911961684024228667828789117872046548334252420871232011368750377344049204068851021627037238790479908608242871213436445125493169445875628830116464169678544768858277911928265979778537624720917132330865116341426113829581250695654607852058185592342874943013483388213939688196018936229226717712099238724536608643862130020930299241089700065596144096977856649900920533270909620198702791708412694441212171342329562384831004598327901425299590271499829758381242448990733950857810223678379721932195167146933230246473932784061153679888913789930120034920172763975203828864212926957154856531532339257754333734406427632770628333745824119480724126001211953632068359393402291383461831384044522919496890950400953097162662591901178104903571938694503982470214186169339056905033841779127092156085266430312174773661705499008991459840572124766733169324197842083823059214830232237634992714404714168728844658536070491541249241505879170326427961032495054521041102412080919404234854258779146864433647481464400047859972328553961263483185024394570762758074008061112913099396983851065370741377950475954483233740322584507470222322626007985848820713655551127897998614231641027770103314044767705362068611579575507833657476610100724146969343065503322276509594721396897902486055454808123299256041302120453399129513608562319415664358715474521910045623429657043528928733698815732853295504153888929819401214322334786750476104946283160999399142040880835561231628359617312716322792644487861905439406729791583678937517450973967451783850668443328209949939542999395760971102106363032400542493111540336395961569167092392651147403562436535808998016926415102681613624723808118211281271874908432308290968248721079333834598772360413864705870189606994868493000949571441873766534716900865402717333059277974559556724057979353444649030048369763751402672600177751013579178373055854314194721161760485020371335880559005886693428569441423930095545386024117285590406212728165021539337640865755106972873830881412214333933884540370099308356121201090155906993526469507732658530948271376344986696495056182029136866409076247141555991639415946859848084593030549177479732153305776083150578410889833337476560731139383164903570194940607178299761175916679311919684747916307396233697603360323106532740943016629346623093245769291372619206450880609825174682332604169785873013517631454625486836632954274337112935543385229373288231891477471152893937978448033357004865134610284747177753122691913432738258773621159811099055719328917856256901944225101978810405067567135462727587432983016017589346660560044994923286246675184620480213886336475229998075832114392782679367973650279074658617959415294509387664637255573809390804636762292726825562747837561704322291622936710482570808281104639944814711648191718053205264874702044375563769183436184373732878763986396439360370411461356437760913038947926256117252042785098417541971593611056574514898990364248488891611019966011693246277101287957470140483189886018456123853039135313139149832141462890591889975501977250353589462098969165651720763844699344281926102738877255232354102493536524842581647182390150624430936484459371613405990136058778240829234066801237179350187375340713074373414218177040646768371976259122565660583655504224220087060206474402991678551361911500300942515163686430071638664287024351455867099475154974845915655379748408840408806021851561094986831224448118776695994354765365720371953521864986746583093988890757791553174340210296325253546311182378308896041005995686635538528358504316899576213768034985519006861855236942727594616861737968021667922102573224930536361926747779022725049273554772441022555414410845097893060364654192664745098445419130880093775595069896650001677959054241369192591479011809298963066674304115372333654261661139327400359741590276731396926106191442097311567798512825057996488178852105487249763342236289370984416211659658704773356627610728590971809630392798744867102793897619241149161640557402742351352730268548274403557496945863565756680733507045837229101674614482366701865636992634032231627282173395120127122156537239538629157309862648054163658158955702952114399235169608518449087030163502677189475331544582697268268377235477245014978021290926278125611934393709447858899185871384306597507675752501937203362172460709757114933892923889324110028568219825935985309679253766391597407084396032603375680933561746415334401745558897488997299294648305725483054833012683670577312352804245694193403866217602656663718642547626650917139218652620399978873481518639387725243594145206567733661334722444952422055162812600464264503972539579418592281286459560313653472360016131846353107441957015241452070765197953748395481518410691658040100493053305637690641680790207546642710097251956331055864225036333427116675164960624522410340404127595319810466118564699278722485226564859016027076154720263137181826963965196570967134402569231634097321201049453856227653849110641403744642306036714127274934158870426490330325127999478943331320123138336319813352548426318037052318367015144348865623159379410331587155690865721756703104968729175445285801696886647792903931481621686806734470784127385776708589695343705509089718514438818413507735255136297511335158110210984912264199248105285078774509880584234237753806266557351228064766151757672835345909319872913105287870981695687468034707629079403382698389883082020209990454409014637718048439122177217326214521930628253550506647102431510905402002293053809910648916924396507128727970065241913511857117350769198240696077669121250260291180880098247095408404890109596080542516535978903754316998605437093484385779945728837396138365995571459045911817106295700156282493291511605313193237138049638535517853395512201081622634566121080448406113929439884855206572282452024801165589438199615041859264984066323764797231748015720527882925322767828344013344509116933814952472695233662615877184998081513529107116610616692242475630385496079066767025419173759158629509999283904254396771253201117046788234975493007574104730929978248303100544797939322377690574334975538123737061222331676677363401474510904345134831845219197538886193523913476453297971283404123024391754548071695805036","2245458456232369269436176280088183899910858032693149781319510960111762706004544973560845569249437465176056959633766398426554550560475257679870832822874319360325624004839328309292106236332306013185393684207331154893687309974005451614912998513200988987778407587691040260581783335047583733296760090994947548113307285623331491504134135105758225756390107673620315783521587451315447932553977034862899901072560326555182467567139284791777455554579350072178199031973085777244607341036453862425979247695464652977104447622268967895810565092481820156096255115854304740571512344686031625591673168086602728641996780846505587570529084552300055075804194240765065620672430319529559592484434796943859652719368808096235417973763310690449808399606976301813896865742589910633890389967030757717949487652729167387556256921384439737298206486440195520923977051434184904242301367635384696865859153702974479548433318158259743981656095510319605139283058680324713862409321189633297168362370992884468031449589472625647946889954454316719655409051085401367601550964171474783387200667615360596061100004026485084907820706498870380758329740590503952872304653560885652428675686119348426165254373811766338428719424386467857777736211485198045426666736128670576934354462884008695104253432595608510276994412467275730408447192659413102077824240643795929033027782515959350080805875763633666581302734162989947787643693814676952622526302643728245555864195558199960641541364424265040274851952737768613818148670281604249575096914503558489704753040326337934376837917619170344768655302374399789189168521255750718559349091710512513010477431645812606684334619838600979144599610724729554485519349427534951453428711599095605458295804238644130708522351913584094546091753047713970235511542167996467874961661565713755307347946930017186940592424119501555202489697351271720457400669310171069445709619462191262884944236670385243429938577975293607029450119951427046971532408355588891940498326103394403973232209512378761229800995043362496188301918544489544504283894901826385554426630764570793037550632305968508671931493598737527457378263993486495374830334340135677178356930120572849754187526724551253414624293134538006820297626655252311205500440189476303857009405738127426198319012379831569414018910462747201626092159139444061663548545037426834945901013443596250455288769055484997979410818293946121432243084767601857919689866713894702185891610560565284312178260581701441490284043282330161015065754418314521006021578962614773097267152480262704738590466562896901699947567109238861776690865643036091056758035959042163777572563421136094283999319103379825385912445189467920784256078540701631362989317438186642341492293485876233816658582079735123438107996619410024654640319046232274071874044091668283305371856547474917626536573458669825337802033450870465718933563468594107942586051398074658924092509490667139741033412143488190640588652629047529895200646586450737636926493520794354303884404034746613846732530184017277250689626883921345081208756397335005802512959131233996669807531865713842504644579418163282493224203964601920801652995720681059234798671510575837224311455455615876827569249653628615618412046227421502249759694468647024609491005226285269057929629747113592353425080876939724193469594400411810684094815123438159676005287405474389260219135778599213085782146890998344172926896591690643637621504013047877443946943700726665195177784012983875412035652633525324226957797821701688097637534286538102380173289530219237595568649620650205704771088679062714121811789582564646505708277502680544863350352830266151334400941167768377973242314614917456784546610195597703942747042455639999588813087509184460683632544602942773287303369296191731576409361368552845828394975498366515735320747841343287209342899422931268136354183017528964278042015595251425865689087458915822215439366739787105498545564751847619194471954909236050486159098854168548922059866089296991216682707489333357951505824865399220201653719599468999033533768351884569086816048320072226394020841956630101860497345180182590042394046319070235353169011540977354712414495289812176141593074585660979710746454602337004451393656561293150734331874400617046367034544199562242562257676895849331208962660226085554312996931125906722285016414024700674689269714897356970325591287853932682676803092620514246821029619491784645999279780245996785250171046325444605088376129048842341518480791502494667350139755883471907881350867086714445991118529045040095688286209545183259811714019556868236400480684558279381813481996138586143314765540343686119403808676623303393875080457210877084422516853468209182154654958347125467352888617486139510419585563350069982218441967235571358914455549688413480190667506648874126034292753648702844956650070834182261780221443077666753407646118064932653156367791960439275633142800606950534107798982674474237111049360380081450559746611009031394004447527421602883931375081999689509059665478985698374951623149191213062250622398756958897020677442887721674071044592573809967636453225098438688388111308665241092166896797208440310988010082453300096732085474094838266882816763948908299761034243320499431585592524304582813230086874941161356505678202619324902060791585727806971279056172282756075443778530476955746153680100178923881680019514510950535575919616576834640447868771717506532816996316019627846433735043076813700510249943615003718446453086161442948232080716864675508737737768377455921430491245549156436533849830514440202835234716626408869337621935726488694981432328604930444600034922209299555141137765092852242991593932460549629637919529954613378690810564205650430331552655089993905011025550355778412285439027388132753802160999482928827234920748920830556460223804726275039293480924291946673288299534544436595995161370135801160169317288559194152510553046068896213088043651907608708164273332741902191255754178932947240815827366222742147095587495752560855017732648823436615658149271277442979727086843311104500421133019184698804394287589861151063244064464545616017551993181790818947137685732311132361777171892538054279615768330249995054136182718391119016484018549542728047830227367980218152956380367791777406780237797202925539207098358522259174819354312491681171109400208933950387599821140676366873722196444143615798034576928468386596746101220784906103097657037691202511345508542380254837731435037509343103548419199690724144585832169195185771913903338812184838682023022248902760122761554296998022700135179929985576423565626955504244017072995365583606520947289502611387064793072625394661981368751323008618037293999003620930815879359319640785424827825986852906506834570227597124278467766885427979494638556511300893702899266319752174914193299246434336669199168483744153902241207764656217862732761876479534967380887642041799166920960970337289087578211153811477048274951407439398475524878820593308362301140099121491122961976647885588929498084059911059118425622323456636543273737176684627109875130575439583658778020843705897322641807399654204196270281553848727960671290589288030339296310613801462442559488559115608575940139107949587413671572044869299351798696276743585452740192187350382470961927961903236974479148921240582135032196041705882424269941448236399397013534710200648593596344806866557787711877836290256775712213837908667059149004623352542880487402692864702237035019886921641255911379705663754132496303772974478981966263747729196167320982579044458964776066838460430163202961718580682679730680436749361149857947690263989908959272376004980252564430285959395692149206711690149916488955494863416812367294801614848858515732641669281980941381514896829987157707512890770931858102543926893470905627000267025888446389105226472800785790305667748058259685575053825852300995676692098928781216482354190885565385398152056780267518674086931327979872379121321129269324872547118900700762096625875228354077952014252888222478965182456248081150535545889673336345823023707003798612582160468090777410534666352062538161065555739240116990018575822540928344365204285713535892921634208080573464241247153994936876251530572963414060122172127400029046644629224342692912365284177799959177586314619616855976160567198024547580205735791567818508867925293426860650975088090820979752800878350673798595802961491254402852625502177885389579595883960634467812576857988628501863129998918229442790061946474679783338396145746462225715956193405800383372718319519508936926386134587851567262285497205591231342282115835871455757264202888665308303249633164947063865342370415314964161459516556277765379944144827195391926429927102028537438339083151938267006553702197345237291537960234852049731120192166803313326288564791854079188804572708004663856724769222687481604862947382196425626951403458068543112314990707907333350672748382922878551110414676642979340121739589902844279440628726286019447838534673236080679199068195697260883708985965293345808343876967915904830957897112763531039126830420662228058969610877123621297034374308976965545512951635011741910922735810672057260200286498047543328051519779078262453835225242287976383793444569678530903288933777488145147754083824826730959050061497512272429874074738811034912470063727687984722751160932530479731726930018154802558494151772370619175138589524626276519402189508071799054982998542356599510828318383107377427094769091293147320694501556090647604068395128867720473480348720029253336642545640311107920259808586298025348977455860719949446612482485503396842836350313841491953458142717330880552429840513110649352366765358013454760012310786432081143339067143622122143557750192516155653609515575855865647190817418099391909051769184569217896060720425451278128717049427565804235023468097434400981418540818180167854457985383268500649204693036841531404543046405018295811221952327561262940209785954241051145758686236963051463897659340034074215674689335461227673637131478796177916440063149102384867595299409898798517457114407220214826821492172101119031459372988976154078516750212092010251780365892100186152021605512951553581787200732930331449965258660380901422233996960759420154635943301464522911397783544803480747177","21240077166749742965296065763034377851754382207127690561560644563184520641395037769127053131670818686564480095982186526948244837690331617441312528137828069375798995135005468630123372414036406982769442388410501738871264699186910070067566295240816939324340809089636659897964999724091243364590677294420908314755125868651153893342119097422516855941324436711589248787323588153876256362537005369103706609426746489012680871471877171112277106602009803377650986993266777246169208439151853762459864907073356752815802297516170908681934742940891023594461951807890431522845031125339911263992938528933336454276486013843247898969609823886932283645782579005410700055759242387671355032114293657732476870744095112524471360907195328924258409796711090139382541837539562676099920756323563576997528804139775405603638636768259885638832791839382402926184316526187607554083710418905489320886758044505928688327089002932083173314769058590178093520102226284843218921660516719456003309000018603847778725743625708362782735190212326654552151713149663463159663801182157974138308251932550310860079876424659971963644542991127574912243124128711375704304120342213923889509408830175479162927842272093166047028438584833360434115748169337274778916963112560561776272087249762618285668960311260878588602085955904807026644488447772496857283854247198949682961350878796853038804613527101505477068123622179554674274198671310815458479468406438890699338059364856851401563524482139578521530035724218848580894016301224571463874774317351344704813608685514188237841033272612002646735808489302797119057959807115434910502734708656060469791029449756873316907957626980122942858084675497188221672335980648573511044785276582120116930556250456589740074581828983767367747968451743500928563723631322770061439742310346967568432077371890621243764228119430222318157421813838887553097597065772710280678884005047437575029888917917041266190030516407121867611599732925402505228637543503786649261375496159036743973253656317539566893778912799170424311824350235564756888387062885578243328304880405152536104800002991805470825225288628144723841601780978180786417825673089357882910529733268879297121994087092289314677284312602058756545007227513816888399828811904856109508824749501918906981419194702047365328702481124084998919956754449768762384814898800743511146175057499612204066720515094466240728356453978316340810145830766093199037013299178051841276942320826836871951334127703852829093316508793709472563413715071535613193634159422617045326279690638080234652029332788232955964874984505783437923505036326927285630099072221603671615726360592721358145773360950723627522286033318223769571207687403100588171802089195658224450897339784712781397094789710741772359529415685445986227821776459564641274337720212679851841438568368818624841575152231076369574165576944651268307186546688645390773086368559958763149604905076463916460492075612622162149226645958700121525744980327119203499715820370727604826608020832586198464152640186463350245124696845548580925667623670723571992909559348456870649269335704554902728715152212453588237469855357865037361339603388888270348625690689241739539041202689295645749141635889420081191693775051982426292709210384083505149258736969119035063813791550833856501302934630533434984799974870048019303592016471186191063842983768310586102162132747954133471608336030671662450909330534738029799045342272546038382641262242946017012156933889838478291240603098026960579541454528441466005233617866939566003351345102539808311308404806467797219461041318246080537928519756593547703521446445950124577183089379561946990521615302479149614040445595126364039635334464320350294139613480314000697838967885028533325233040880323319497550823149807888254599149912759815510593105763381352348564795392343692519400041928345856701931672794123350914060773740278087723982838559863851264253133102722419203610527568910162923245498977448771466469484537564007669019416688191900815282007303287309827095342429393435564291815323503501636073472342749793284969175052616305066585565471245691912726668403996805310268572606040318947180052485363840818475621162542443334467188392776086152941576240711589766308191842829630166441683660840891978851159344805243995706408209928887053417557904374779805490291601884187668143436929345456182682687211594073883465285927990438393448422125134890933542171972901737614681273627089480612606245845068326267449018271595054138553239915933334322213228414741838227981476576939846392551426746099458650388224121175723033899524572941082323162852903627523754672360667125505870705990299634965974487598257165967889924534035562192300890756337961675633320327084754700674604379164585693186211737342431968118812354171229195857389459266292264180408003796069355315461979367555042365241322531161483861801354094571100634739393843447101047513290932397962456210497534889210853355032331717291280624938605350986403083064158103504370391971562097952289688938487694556994512892705341158266284936575725613979047114266035099406939616627714008173709944312325081255948033831353336861428870984270364860270872897530486155002683145391542288967100066551431666042209736777714151104354127433390136791382252545339822538648296967617526977544490223263277661250132730910482592643677308202447495488432859262226348063899168320386828393661893249331963966676577967445245689317527915231111699288818846156190192642194138148722593826902625311264481998970600421999297241868551778454879008788680559719138102866079410008466397265929879191212962425405810895664381467023060983908520891907319407731479217531219476190799325857457950664647583947305712411647804413828664270708156357670690361927510322695143228206637442236730210796500421699916250628821000025746528791731732239311289004271651095861197406442140194500987820371233204608291147543831721968911902687641865859985202684917468929864101591655440793248503011487596758656712755866621518522823581351362936009503951529441749489433037532007036579665943456711174538685320848966558227032978485968956386043444252143116444590953339272059582356872748588973688821125970612494832515422452004856600563617612020669123718904402372299427760474927521083187550976018925927333561592574585111180345917363098927833305675941402178433586825482418288866122029969211475566691477930319446431916483412333564908327285474119677368832451719434212103260526993413584248378771109294602934099185628999560135181847128748753823279418851743614786237734129588843390940237827989909716420021531713787814915602644131469985554930739513926353804350778704372665366116290247356348405685625803787070833489945998332129207829979275490885208706880221284942929737995485340157871240728329359294487922640647347459457523973194291066340898412193818562803331737002397369987260715224941123356464750459321617703930326048706332972948906435552689690348458081877430153219187670969023743976921767233575120903352416661991363906085372604716920930362141800160164734459993536953479639467020930869537292584357500761204985107332860214418898922909407029207594871922408380938496264537321781752052665305223178617175860218798755656958722650357413351092152113610257742166565456697125262394020537741900660632669043700957734958055894146777321655674622892412901079462645190051835047249312118172122536076528734081967501062030274113665407251391255596643431074119060257951812639280374996803968574762619183056861646378286109122218748654906804558778928114498300851720390338908298129338988764731785515551589128218635368845652234273818605233583333645859570759282958876997824868096642818547192409792510778210384861636670866918822972227322687962207776068493062386422570125011423138262424729857508197187181948900122774992246841625885645775479682612639599345406929734577419506955752320590039908018350684960575315124366069261810368321553453070657052555608970588487240701373463055797808005218604291525590851737948833617217829539327245059715362362009764336048372579242661706023919584972891997782890830251271643218620743617708738913214954313710890000021200472224232081035371882971857778951825715536137862356108792900974548626883480827793001180375581099942126857300954654002406865805086413182097908136228003452558293956450843891952498503414940192141052641468766305072306300355303849423230940849523117649424984125947951795893839802116453408153918286819960488459547928068116322831616889862730381218434579866317656886603591170575175175303634957857893466324562346325593457545747338261484475071217310086701551985732880297814357730918749258187145881357370320177045135080638583186173336114430119424636724157908879881748392383982579410416171436468462982608515311407960316823361200783001832642804642742884750510179189268836114749251435606178535529506521737261526450358782484584484029257602071040317621075542221611836759803197793168053283955485819450264880936143819783743846575510720432059211945251968573491679889771193177922006822293523309866554571922050933144356547408550611028665955245646244755124568516031280065679159831817323260017507620068914625334619060862808500858894091263102015881298933751146981114142016350709054863680902952082902920209028632364738621087052824294644010021961992206457216297557701179833841537884233359223876205637573400473345447621302356492873862617504892114963879677235968494726857620998411298074692901253118721414003074505930424598314376384692756939565083759318384645592729986399243021092712729615840274501473537193935899765813045981936182361240690677465927754134100944516915945677001539973687385737264820831550361900604550573065554881036143381438376380101964394676397788015072336013040580669321181393255851889263130626190439703138370041036608578157712336944637045703669331638038900779637683345505217764551871087706141356091644766079562362563163192691391940657680411799750611390690101354627767815355591657365876816621278561085261430491447645255464181492442869804780153921036258996630566669347112295036428940748547382480634859742453686168327187897281211384713113090884965230716477316963477958164921815630171639858644937965774754640307085960355847336337083293094073452327879387604513738974897786443611015262756511908332460748442762244514578324824909826287594691580779476312604634268464095551802766233163572103859899664301557605344634093695597252481044090785666917678507901818143577789939242784217728369474872554117256960656504620506476152037160604051785055445963386643755769707627413145794648760027819711857276045706973460690734647798760660169637492788953511071525249789539570665671442917678108707916095146924891827661893595767976046477909535364251835813586266581617181412682513675966484112782022306726333691376567404803479648818550232998551601866997486460777585491547294426178603126691005454171214489749734019770005930404270932499596363711515556242378655695227140387817060732337653445011216068557900028571208407641268890375977204918270168912341902241073848521429474949405863856895521008131604621466705218158846522081541541437611476891678163819607943318135659554547805439190930487570240367509075823793366278881341515355973210328791277234748953322803357171741917542233352455475200803350987029498030464774042467685493625609015128617731263657268232689464353276788654077241837730394503240310931479509352503027241893138530006621944590007479251718135737097529415665108534680076836648553726084839297737237726318540638098080651313674231853627986245760621776961852900854264355159649934930226539589014422168177774930759678612769893272759048401789444703119132397135868779948925262656608011695895024408866826734423858289387672786811796356351563209934443537232461594259245038511305759148026874930157917057736762218964043604319857811526313195328137056842632959753836354507456239775749217756181024858031729276927661777438014546868925776488586077462968236462612801887199025519191921916762455424232030332751602482838381980786743563492131132468900941804241991433894935821670886351652333429408993632857659662832844633630126798490688509506250458832929274361138616336131582027576226786868068753485767761293434259517407166224948187020782471785964317830858970805394695817389660359652342296524815182594615314771174042321349483529755009108101137519703934677119817372381208044331798487790827176621987966737693752219138751139304417532118068810988147037748748485778211712560784611493339206709323854572281009215643236219079699737444355536340580018014539243401452124871605175866523242560378741088315377756425797063651828077742827412901738542271388719383323867298158115724446374266329037918651727927189145998431093525513728114573396190397852791545421787329922733715716974588364234535176366134526577849756240636397794528411167506619705805196405326948255730322600369666692398108147235076421443486420261504511884757099629961413380476136873830864933287174264250902515736892055117544540041018299279465690713700624036791527380857016477164649772913861926533669490973806642696173999530886521261845415533581353359922467136923524832557638907959332017034046606400082083556192134273520703399161453781730452172856734904132908998344754157457381029477624116333590425052438670221050373337457149970494548715861390982111552251113709644332340684209414901089908329332985518391936503328381422630305624283637097252300936311012165181586215597838367389552630814461854077517722664954866459121764326104298983888896419174210114578995476291561570006146031366191870716450657376165942012615060665315101585093214459913113404594711853019866059979741698708188531404876042614124056047243220548533572521753903187398324953002668826959797899464094037121582564770174963738582479212566741119537752254809693145269293167781295679979505425295825811660570727733207966957019385196942621367182351015402598652250601176676601999161553130619841931321480983189831430064962423649134560005819436877562121689934588212569855524780968007378007122398217270579308695777119023873828967187707765632914499545496110984093478757762408430444638466950762282574052363349763324271643782323828735894444034152273169122614177868075454097246539786441757775781507303089401384880770376555668391883225942502081897124133688077009190350353244629459113495319462879210589521594335203777943674098457719807490714424921627359763358726701333922954526770256966255484969852972566124561091832121664860957041592052299184684743973034754442658671763630917205078395227410379915716178175646539375847965758850328452427869593265106924422682837142384909797090864679396679756861278827343224524850084708636704799006203153508639414684975581675251591649680381681543515210534199409094417631084968671139752014924161067835297305108554917843906089255027742794441730524011344133083986770131776087606919459995327958677658728425999698617050486130534687932367490217410706190866063222260210062289171226789740571064603965915481464836005278525676708606285269662664994518057696677726900762442664225860645698557255045792294973577373961635650139308101128490825587419913953989525522993539421676006107759983610600232932589486202769080365056915588854833225970398814425884383984915263597185325973792936271782749778762554748555598666991664081456413891146615652476528454183175565172073272309634889762497479095553404217159773492145332875887867159025699299943172268682120204992969467160349976041668773070759663940016607081153890775226336504161760951116468716477075798739501011116805227351306868172206169710501737408845697272466985362948224791558708558512018726432297853627891418882290650568945626364825476831551157924355929620230361697959418903462945584179025915936339714310103509957725223237520857043143626099911629217281097531343505315584029531197790055702988590524099949437618558764598804501896940470442808648862034720686997384018346143961431603384218961427238153195735602991650484640140325397112014043111939025859123693569891758288519631671958434283929601008436740841110820911108718426794115170455483341082665348839511555313016372448987958043875132828575723053347016241644264019798470574009094208453102427856470997118195011944256231457403934037877065215025851443210156731791448295479547330519532526373510320620149194458831347294800854267950747453744032640753809897200725297133012572088978092299947232344896907967475558768754553664153700069879325903270981772761867227424405898649549941029402551861881488164665172917075101884212282825781394667314846165342313395120186848626961618869961110288391027593482546449379464057925300941492222821585370252259734487192687724332184102336416827222904708321330408743777104050723202242184928787899408901000827358088751321705580601220401827693554671111057774334179535087474001644819539744972501240517955193806912064429289563023185989788450946920852546905277757862333022009703482825319598593847022004285355900542923504693921876969939401601374947469335474038224289400128630520126812523990551341419939128456110693209405706535414788203428793662647479669786342397909103593409045286833945803703469722936516175901906059365151731916739124689088668983942463967114333663089356471714336862218445628683794818434947619646802080541454868260949101300456973129778456480037943197356000451616708770405912913604654826666335524881751936727618177803285942250929107862999031779077755503386723925934766035445462824859083323084036678541552546525911889009553558847395878308389139262498273929829838356091068274991338771892818669441269379049806761209177561930415857131005101126959777161770471358724741473353825307937730601121160827712658621401254295661940028611872271903305254091686148958740783425841945276967431434666542175952875059257305107185874202263405494169009372236060091384333914064298527252335224829049454372138032774267327646591067394993726997812748548076491455715419220476724421633322159457983631962358059027699668019326548058729925421738272664946854094619562614580053889219425363365019340489568987225671710971853407938467503618957687446027399402459151622201846603532738217817887571388713680484696420248742920513008033817049149093924222263088747764990149888232674840601697459255561958039547965423994137545752803144901700579104706518060894209733517176615703003355373999151824943108699206126520079721778872374206595500565017497621987500179584988086947660042701612994121532493966686913915962218096562041688206069082900112524767570512226028114320865869000794441003661311417244039221903437321203784602132605975927542026875341287885201751346457903718599147897795331073105786472010950429217020086333377220832350375459768517922778532695546108895354335701212334026144328274234665170239045245065006645143460250255523053256097334565552485210914152083772015078537022130900180753366724301722529566187266271689875174489619720191661345179039151250889701317382867377876641790150721636286289135680123906991184197673173225978247978168248605221070069283332255146052423823098097642881885797293587058273406759089716041683838161731199502047927165214452283791635197990257448188865359738746865541187454824372517594171511539746394464913996093202593844276058605251468345256938804023546031026305164298124461236627466450519173536384437169395962860622889599565716554085861841616162456733617133332299932511328859606789771385259594808998322576314897391740779145643525127182911218435738749704888058117421382658306983482902055238969718773886869004032237881143808606926379847693926810190367359680087595553819345581972043807700971129388386908968831868903576083392123235928394574053219154887353955166484687663125045105601689418541747451401249090976326481269285404310557286344202991643355056762490271092431540478595211258464825574175214332625799808438352921491731519250377990621286095237987160693594844852239453769855284462372455448773220632068164276825923425630042269997167707601006617541231430484880421374339168067080753366504491770608762766104337799251193522689516113895377259779200925551604297878519399226832386683750621579114764649096555026613859428661589344612093387667993956493684493644379219710401324952477524179094014758654184292567272590683686728378323024845595966553499236544190342445552047876472597082416047265887673724279233317971061126991270874754422010141824333135878331877673348067955155682784663591539849062859579954944652187423032620049379898102472597531872744395200282003815601715028469964386421756503567842593082781871073218861905625954822690996584792088604643455787237579781799383372"},
    {"\5","",""}
  };
  char testDivd[][3][1000] = {
    {"10","2","5"},
    {"2","2","1"},
    {"100","3","33"},
    {"9174","83","110"},
    {"-9174","83","-111"},
    {"-9174","-83","110"},
    {"9174","-83","-111"},
    {"121932631112635269","987654321","123456789"},
    {"121932631112635268","987654321","123456788"},
    {"0","10","0"},
    {"1298473924639124679141394679814798353831216508312469124638912461372483164712481249324981249834781259382678412464831649783124697826578569847031264971324698125467381256918256798461324697815197258647812647981246731467981246837125637981567139849812469817491432469185637214689312469478","1","1298473924639124679141394679814798353831216508312469124638912461372483164712481249324981249834781259382678412464831649783124697826578569847031264971324698125467381256918256798461324697815197258647812647981246731467981246837125637981567139849812469817491432469185637214689312469478"},
    {"01298473924639124679141394679814798353831216508312469124638912461372483164712481249324981249834781259382678412464831649783124697826578569847031264971324698125467381256918256798461324697815197258647812647981246731467981246837125637981567139849812469817491432469185637214689312469478","1","1298473924639124679141394679814798353831216508312469124638912461372483164712481249324981249834781259382678412464831649783124697826578569847031264971324698125467381256918256798461324697815197258647812647981246731467981246837125637981567139849812469817491432469185637214689312469478"},
    {"\5","",""},
    {"","",""}
  };
  char testMod[][3][1000] = {
    {"10","4","2"},
    {"100","3","1"},
    {"9174","83","44"},
    {"-9174","83","39"},
    {"-9174","-83","-44"},
    {"9174","-83","-39"},
    {"121932631112635269","987654321","0"},
    {"121932631112635268","987654321","987654320"},
    {"0","10","0"},
    {"1298473924639124679141394679814798353831216508312469124638912461372483164712481249324981249834781259382678412464831649783124697826578569847031264971324698125467381256918256798461324697815197258647812647981246731467981246837125637981567139849812469817491432469185637214689312469478","173267781","93086883"},
    {"01298473924639124679141394679814798353831216508312469124638912461372483164712481249324981249834781259382678412464831649783124697826578569847031264971324698125467381256918256798461324697815197258647812647981246731467981246837125637981567139849812469817491432469185637214689312469478","1","0"},
    {"\5","",""},
    {"","",""}
  };
  char testDeg[][3][10000] = {
    {"1","1000000","1"},
    {"0","1023817","0"},
    {"1","-3213","0"},
    {"2","-4","0"},
    {"241","1","241"},
    {"241321566","0","1"},
    {"0","0","1"},
    {"12","100","828179745220145502584084235957368498016122811853894435464201864103254919330121223037770283296858019385573376"},
    {"\5","",""},
    {"","",""}
  };

  int result = 0, i = 0, sig = 0, count1 = 0;
  int error;
  BigNum *a = 0, *b = 0, *c = 0;
  FILE *f = fopen("BigNumTests.html","wt");
  fprintf(f,"<!DOCTYPE html><html><body style='font-family:\"Ubuntu Mono\"'>");
  fprintf(f,"<h1>BigNum MODULE TESTS from %s %s</h1>\n",__DATE__,__TIME__);
  {
    fprintf(f,"<h2>#%d. Interconversion tests</h2>\n",count1++);
    {
      for (i = 0; '\5' != testInterconversion[i][0][0]; i++){
        fprintf(f,"<b>#%d.1.%d</b>:&nbsp;",count1,i+1);
        a = stringToBigNum(testInterconversion[i][0],&error);
        sout = BigNumToString(a,&error);
        result = (!strcmp(testInterconversion[i][1],sout));
        fprintf(f,"%s<br>\n",resultHtml[result]);
        if (!result) fprintf(f,"In:\"%s\", Out:\"%s\", Right:\"%s\"<br>",testInterconversion[i][0],sout,testInterconversion[i][1]);
        deleteBigNum(a);
        free(sout);
        fflush(f);
      }
      {
        fprintf(f,"<b>#%d.2</b>:&nbsp;",count1);
        sin = "084a965911030412040148392";
        a = stringToBigNum(sin,&error);
        result = (PARSE_STRING_ERROR == error);
        fprintf(f,"%s<br>\n",resultHtml[result]);
        if (!result) fprintf(f,"Error test, in=\"%s\"<br>",sin);
        deleteBigNum(a);
        fflush(f);
      }
    }

    fprintf(f,"<h2>#%d. Interconversion int->BigNum tests</h2>\n",count1++);
    {
      for (i = 0; 777 != testInt[i]; i++){
        fprintf(f,"<b>#%d.1.%d</b>:&nbsp;",count1,i+1);
        a = intToBigNum(testInt[i],&error);
        sout = BigNumToString(a,&error);
        result = (!strcmp(testIntAns[i],sout));
        fprintf(f,"%s<br>\n",resultHtml[result]);
        if (!result) fprintf(f,"Num:%lli Out:%s Right:%s\n",testInt[i],sout,testIntAns[i]);
        deleteBigNum(a);
        free(sout);
        fflush(f);
      }
    }


    fprintf(f,"<h2>#%d. Base Math tests</h2>",count1++);
    {
      for (i = 0; (-127) != testsModChar[i][0]; i++) {
        fprintf(f,"<b>#%d.1.%d</b>: modchar & bigchar&nbsp;",count1,i+1);
        result = (testsModChar[i][2] == modchar(testsModChar[i][0],testsModChar[i][1]));
        result = result && (testsModChar[i][3] == divchar(testsModChar[i][0],testsModChar[i][1]));
        fprintf(f,"%s<br>\n",resultHtml[result]);
        if (!result) fprintf(f,"%d%%%d == %d, /== %d<br>",testsModChar[i][0],testsModChar[i][1],testsModChar[i][2],testsModChar[i][3]);
        fflush(f);
      }
    }

    fprintf(f,"<h2>#%d. unDif test</h2>\n",count1++);
    {
      for (i = 0; '\5' != testUnDif[i][0][0]; i++) {
        fprintf(f,"<b>#%d.0.%d</b>:&nbsp;",count1,i);
        printf("%d.%d S",count1,i);
        a = stringToBigNum(testUnDif[i][0],&error);
        sig = a->sig;
        c = unDif(a,1,&error);
        sout = BigNumToString(c,&error);
        result = ((!strcmp(testUnDif[i][1],sout)) && (sig == a->sig));
        fprintf(f,"%s ",resultHtml[result]);
        if (!result) fprintf(f,"Return mode: -\"%s\" = <br>\"%s\", Right:<br>\"%s\", signum of a: %d -> %d<br>",testUnDif[i][0],sout,testUnDif[i][1],sig,a->sig);
        free(sout);

        unDif(a,0,&error);
        sout = BigNumToString(a,&error);
        result = (!strcmp(testUnDif[i][1],sout)) ;
        fprintf(f,"%s<br>\n",resultHtml[result]);
        if (!result) fprintf(f,"Stack mode: -\"%s\" = <br>\"%s\", Right:<br>\"%s\", signum of a: %d -> %d<br>",testUnDif[i][0],sout,testUnDif[i][1],sig,a->sig);

        deleteBigNum(a);
        deleteBigNum(c);
        free(sout);
        fflush(f);
        printf("E\n");
      }
    }

    fprintf(f,"<h2>#%d. Add tests</h2>\n",count1++);
    {
      for (i = 0; '\5' != testAdd[i][0][0]; i++){
        fprintf(f,"<b>#%d.1.%d</b>:&nbsp;",count1,i);
        a = stringToBigNum(testAdd[i][0],&error);
        sig = a->sig;
        b = stringToBigNum(testAdd[i][1],&error);
        c = add(a,b,1,&error);
        sout = BigNumToString(c,&error);
        result = ((!strcmp(testAdd[i][2],sout)) && (sig == a->sig));
        fprintf(f,"%s ",resultHtml[result]);
        if (!result) fprintf(f,"Return mode: \"%s\" + \"%s\" = \"%s\", Right:\"%s\", signum of a: %d -> %d<br>",testAdd[i][0],testAdd[i][1],sout,testAdd[i][2],sig,a->sig);

        add(a,b,0,&error);
        sout = BigNumToString(a,&error);
        result = (!strcmp(testAdd[i][2],sout));
        fprintf(f,"%s<br>\n",resultHtml[result]);
        if (!result) fprintf(f,"Stack mode: \"%s\" + \"%s\" = \"%s\", Right:\"%s\", signum of a: %d -> %d<br>",testAdd[i][0],testAdd[i][1],sout,testAdd[i][2],sig,a->sig);

        deleteBigNum(a);
        deleteBigNum(b);
        deleteBigNum(c);
        free(sout);
        fflush(f);
      }
    }

    fprintf(f,"<h2>#%d. Dif tests</h2>\n",count1++);
    {
      for (i = 0; '\5' != testDif[i][0][0]; i++){
        fprintf(f,"<b>#3.1.%d</b>:&nbsp;",i+1);
        a = stringToBigNum(testDif[i][0],&error);
        sig = a->sig;
        b = stringToBigNum(testDif[i][1],&error);
        c = dif(a,b,1,&error);
        sout = BigNumToString(c,&error);
        result = ((!strcmp(testDif[i][2],sout)) && (sig == a->sig));
        fprintf(f,"%s ",resultHtml[result]);
        if (!result) fprintf(f,"Return mode: \"%s\" - \"%s\" = \"%s\", Right:\"%s\", signum of a: %d -> %d<br>",testDif[i][0],testDif[i][1],sout,testDif[i][2],sig,a->sig);

        dif(a,b,0,&error);
        sout = BigNumToString(a,&error);
        result = (!strcmp(testDif[i][2],sout)) ;
        fprintf(f,"%s<br>\n",resultHtml[result]);
        if (!result) fprintf(f,"Stack mode: \"%s\" - \"%s\" = \"%s\", Right:\"%s\", signum of a: %d -> %d<br>",testDif[i][0],testDif[i][1],sout,testDif[i][2],sig,a->sig);

        deleteBigNum(a);
        deleteBigNum(b);
        deleteBigNum(c);
        free(sout);
        fflush(f);
      }
    }

    fprintf(f,"<h2>#%d. Multiple test</h2>\n",count1++);
    {
      for (i = 0; '\5' != testMul[i][0][0]; i++){
        fprintf(f,"<b>#%d.%d</b>:&nbsp;",count1,i);
        a = stringToBigNum(testMul[i][0],&error);
        sig = a->sig;
        b = stringToBigNum(testMul[i][1],&error);
        c = mul(a,b,1,&error);
        sout = BigNumToString(c,&error);
        result = ((!strcmp(testMul[i][2],sout)) && (sig == a->sig));
        fprintf(f,"%s ",resultHtml[result]);
        if (!result) fprintf(f,"Return mode: \"%s\" * \"%s\" = <br>\"%s\", Right:<br>\"%s\", signum of a: %d -> %d<br>",testMul[i][0],testMul[i][1],sout,testMul[i][2],sig,a->sig);

        mul(a,b,0,&error);
        sout = BigNumToString(a,&error);
        result = (!strcmp(testMul[i][2],sout)) ;
        fprintf(f,"%s<br>\n",resultHtml[result]);
        if (!result) fprintf(f,"Stack mode: \"%s\" * \"%s\" = \"%s\", Right:\n\"%s\", signum of a: %d -> %d<br>",testMul[i][0],testMul[i][1],sout,testMul[i][2],sig,a->sig);

        deleteBigNum(a);
        deleteBigNum(b);
        deleteBigNum(c);
        free(sout);
        fflush(f);
      }
    }

    fprintf(f,"<h2>#%d. Divide test</h2>\n",count1++);
    {
      for (i = 0; '\5' != testDivd[i][0][0]; i++) {
        fprintf(f,"<b>#%d.0.%d</b>:&nbsp;",count1,i);
        printf("%d.%d S",count1,i);
        a = stringToBigNum(testDivd[i][0],&error);
        sig = a->sig;
        b = stringToBigNum(testDivd[i][1],&error);
        c = divd(a,b,1,&error);
        sout = BigNumToString(c,&error);
        result = ((!strcmp(testDivd[i][2],sout)) && (sig == a->sig));
        fprintf(f,"%s ",resultHtml[result]);
        if (!result) fprintf(f,"Return mode: \"%s\" / \"%s\" = <br>\"%s\", Right:<br>\"%s\", signum of a: %d -> %d<br>",testDivd[i][0],testDivd[i][1],sout,testDivd[i][2],sig,a->sig);
        free(sout);

        divd(a,b,0,&error);
        sout = BigNumToString(a,&error);
        result = (!strcmp(testDivd[i][2],sout)) ;
        fprintf(f,"%s<br>\n",resultHtml[result]);
        if (!result) fprintf(f,"Stack mode: \"%s\" / \"%s\" = \"%s\", Right:\n\"%s\", signum of a: %d -> %d<br>",testDivd[i][0],testDivd[i][1],sout,testDivd[i][2],sig,a->sig);

        deleteBigNum(a);
        deleteBigNum(b);
        deleteBigNum(c);
        free(sout);
        fflush(f);
        printf("E\n");
      }

      fprintf(f,"<b>#%d.1.0</b>:&nbsp;",count1);
      {
        printf("%d.1.0 S",count1);
        a = stringToBigNum("12414",&error);
        sig = a->sig;
        b = stringToBigNum("0",&error);
        c = divd(a,b,1,&error);
        result = error == DIVISION_BY_ZERO;
        fprintf(f,"%s ",resultHtml[result]);
        if (!result) fprintf(f,"Error check: division by zero<br>");

        divd(a,b,0,&error);
        result = error == DIVISION_BY_ZERO;
        fprintf(f,"%s ",resultHtml[result]);
        if (!result) fprintf(f,"Error check: division by zero<br>");

        deleteBigNum(a);
        deleteBigNum(b);
        deleteBigNum(c);
        fflush(f);
        printf("E\n");
      }

    }

    fprintf(f,"<h2>#%d. Mod test</h2>\n",count1++);
    {
      for (i = 0; '\5' != testMod[i][0][0]; i++) {
        fprintf(f,"<b>#%d.0.%d</b>:&nbsp;",count1,i);
        printf("%d.%d S",count1,i);
        a = stringToBigNum(testMod[i][0],&error);
        sig = a->sig;
        b = stringToBigNum(testMod[i][1],&error);
        c = mod(a,b,1,&error);
        sout = BigNumToString(c,&error);
        result = ((!strcmp(testMod[i][2],sout)) && (sig == a->sig));
        fprintf(f,"%s ",resultHtml[result]);
        if (!result) fprintf(f,"Return mode: \"%s\" / \"%s\" = <br>\"%s\", Right:<br>\"%s\", signum of a: %d -> %d<br>",testMod[i][0],testMod[i][1],sout,testMod[i][2],sig,a->sig);
        free(sout);

        mod(a,b,0,&error);
        sout = BigNumToString(a,&error);
        result = (!strcmp(testMod[i][2],sout)) ;
        fprintf(f,"%s<br>\n",resultHtml[result]);
        if (!result) fprintf(f,"Stack mode: \"%s\" / \"%s\" = \"%s\", Right:\n\"%s\", signum of a: %d -> %d<br>",testMod[i][0],testMod[i][1],sout,testMod[i][2],sig,a->sig);

        deleteBigNum(a);
        deleteBigNum(b);
        deleteBigNum(c);
        free(sout);
        fflush(f);
        printf("E\n");
      }

      fprintf(f,"<b>#%d.1.0</b>:&nbsp;",count1);
      {
        printf("%d.1.0 S",count1);
        a = stringToBigNum("12414",&error);
        sig = a->sig;
        b = stringToBigNum("0",&error);
        c = divd(a,b,1,&error);
        result = error == DIVISION_BY_ZERO;
        fprintf(f,"%s ",resultHtml[result]);
        if (!result) fprintf(f,"Error check: division by zero<br>");

        divd(a,b,0,&error);
        result = error == DIVISION_BY_ZERO;
        fprintf(f,"%s ",resultHtml[result]);
        if (!result) fprintf(f,"Error check: division by zero<br>");

        deleteBigNum(a);
        deleteBigNum(b);
        deleteBigNum(c);
        fflush(f);
        printf("E\n");
      }

    }

    fprintf(f,"<h2>#%d. Degree test</h2>\n",count1++);
    {
      for (i = 0; '\5' != testDeg[i][0][0]; i++) {
        fprintf(f,"<b>#%d.0.%d</b>:&nbsp;",count1,i);
        printf("%d.%d S",count1,i);
        a = stringToBigNum(testDeg[i][0],&error);
        sig = a->sig;
        b = stringToBigNum(testDeg[i][1],&error);
        c = deg(a,b,1,&error);
        sout = BigNumToString(c,&error);
        result = ((!strcmp(testDeg[i][2],sout)) && (sig == a->sig));
        fprintf(f,"%s ",resultHtml[result]);
        if (!result) fprintf(f,"Return mode: \"%s\" ^ \"%s\" = <br>\"%s\", Right:<br>\"%s\", signum of a: %d -> %d<br>",testDeg[i][0],testDeg[i][1],sout,testDeg[i][2],sig,a->sig);
        free(sout);

        deg(a,b,0,&error);
        sout = BigNumToString(a,&error);
        result = (!strcmp(testDeg[i][2],sout)) ;
        fprintf(f,"%s<br>\n",resultHtml[result]);
        if (!result) fprintf(f,"Stack mode: \"%s\" ^ \"%s\" = \"%s\", Right:\n\"%s\", signum of a: %d -> %d<br>",testDeg[i][0],testDeg[i][1],sout,testDeg[i][2],sig,a->sig);

        deleteBigNum(a);
        deleteBigNum(b);
        deleteBigNum(c);
        free(sout);
        fflush(f);
        printf("E\n");
      }
    }

  }

  fprintf(f,"<hr> Test ended!</body></html>");
  fclose(f);
}

#endif
